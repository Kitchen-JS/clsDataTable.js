/*
 * Data Table Class that accepts JSON Data to display in a Table
 * Copyright (c) 2023 Kitchen JS - https://kitchenjs.org/
 * @version 1.1.1
 * @constructor
 * @param {object} options - Data Table options object
 * @param {object} options.keyMap - Options for columns and header title, hidden, render
 * @namespace
 * @property {object}  options                  - options object
 * @property {object}  options.keyMap           - Keymap for setting title, functions to render value
 * @property {string}  options.keyMap.title     - Set the column title
 * @property {object}  options.keyMap.render    - Function passed in to manipulate the cell
 * @property {number}  options.keyMap.hidden    - Hidden column still in html on page
 * @property {number}  options.keyMap.remove    - Remove column from dataset
*/
class clsDataTable{constructor(t){void 0===t&&console.error("clsDataTable - options must be defined"),void 0===t.container&&console.error("clsDataTable - options.container must defined"),void 0===t.altRowColor&&(t.altRowColor=!0),void 0===t.sort&&(t.sort=!0),this.sortVal=1,void 0===t.freezeHeader&&(t.freezeHeader=!1),void 0===t.includeFooter&&(t.includeFooter=!1),void 0===t.refreshFunction&&(t.refreshFunction=()=>{this.setJsonData(this.jsonDataOriginal)}),void 0===t.hideButtons&&(t.hideButtons=!1),this.options=t||{},this.keyMap=t.keyMap||null,this.container=t.container,this.id,this.jsonDataOriginal,this.jsonData,this.table,this.filterUI,this.filterBtns,this.filters={},this.keys,this.sortObj={},this.events={},this.symbols={},this.minWidth="380px",this.initialize()}initialize(){this.id=this.randomID(),this.container.id=this.id||this.randomID(),this.container.classList.add("clsDataTableContainer"),this.container.style.minWidth=this.minWidth,this.filterUI=document.createElement("div"),this.filterUI.classList.add("filterUI","kw-hidden"),this.container.append(this.filterUI),this.symbols.filter="",this.symbols.disk="",this.symbols.paperclip="",this.symbols.printer="",this.symbols.expand="",this.symbols.magnify="",this.symbols.refresh="";Object.keys(this.symbols).forEach(t=>{this.symbols[t]=document.createElement("img"),this.symbols[t].src="data:image/svg+xml;charset=utf-8,",this.symbols[t].classList.add("toolbar-button")}),this.symbols.filter.src+='<svg xmlns="http://www.w3.org/2000/svg" width="2.835" height="2.835" fill="DimGray"><path d="M2.803.042A.087.087 0 002.729 0H.104a.08.08 0 00-.071.042.084.084 0 000 .084L1.075 1.93l-.002.04v.517c0 .041.023.08.061.1l.469.237a.116.116 0 00.051.012.114.114 0 00.112-.113V1.97c0-.014 0-.026-.002-.04L2.807.126a.103.103 0 00-.004-.084z"/></svg>',this.symbols.disk.src+='<svg xmlns="http://www.w3.org/2000/svg" width="2.835" height="2.835" fill="DimGray"><path d="M2.83.789l-.51-.77A.038.038 0 002.287 0H.091C.042 0 0 .044 0 .101v2.633c0 .057.041.102.091.102h2.653c.051 0 .092-.045.092-.102V.81C2.835.801 2.833.792 2.83.789zM.315.21c0-.028.024-.05.052-.05H2.22c.027 0 .057.021.057.05l-.004.844a.055.055 0 01-.053.052H.367a.052.052 0 01-.052-.052V.21zm2.203 2.327c-.001.031-.026.063-.06.063H.375c-.031 0-.059-.027-.059-.063v-1.02a.06.06 0 01.059-.061h2.083c.03 0 .063.026.063.061l-.003 1.02z"/><path d="M2.185 2.152H.652c-.051 0-.092.027-.092.061 0 .035.041.063.092.063h1.533c.051 0 .09-.024.09-.063 0-.034-.041-.061-.09-.061zM2.185 1.712H.652c-.051 0-.092.026-.092.06 0 .036.041.062.092.062h1.533c.051 0 .09-.025.09-.062 0-.033-.039-.06-.09-.06z"/></svg>',this.symbols.paperclip.src+='<svg xmlns="http://www.w3.org/2000/svg" width="2.834" height="2.834" fill="DimGray"><path d="M2.068.395L.534 1.931a.29.29 0 000 .414.292.292 0 00.412 0L2.477.815A.483.483 0 002.58.294a.493.493 0 00-.258-.259.496.496 0 00-.366.001.456.456 0 00-.154.104L.247 1.694a.672.672 0 00-.001.946h.001c.13.131.301.195.472.195a.664.664 0 00.473-.195l1.561-1.561a.097.097 0 000-.137.096.096 0 00-.138 0L1.054 2.503a.472.472 0 01-.671 0 .472.472 0 01.001-.67L1.938.278a.28.28 0 01.308-.061.28.28 0 01.176.262.305.305 0 01-.021.108.286.286 0 01-.063.091L.809 2.21a.095.095 0 01-.07.027.102.102 0 01-.067-.027.092.092 0 01-.029-.068c0-.025.008-.051.028-.07L2.208.536a.097.097 0 000-.137.095.095 0 00-.14-.004z"/></svg>',this.symbols.printer.src+='<svg xmlns="http://www.w3.org/2000/svg" width="2.835" height="2.835" fill="DimGray"><path d="M2.986.962H2.59V1.39H.243V.963h-.396c-.117 0-.211.074-.211.164V2.106h.51v-.312h.158v.946c0 .054.041.096.094.096h2.039a.094.094 0 00.095-.096v-.946h.154v.311H3.2v-.979c-.002-.089-.097-.164-.214-.164zM2.09 2.373H.761c-.043 0-.08-.027-.08-.063s.037-.062.08-.062H2.09c.043 0 .079.026.079.062s-.036.063-.079.063zm0-.453H.761c-.043 0-.08-.028-.08-.062s.037-.062.08-.062H2.09c.043 0 .079.027.079.062 0 .034-.036.062-.079.062zm.818-.672a.092.092 0 01-.092-.092c0-.049.041-.09.092-.09s.091.041.091.09a.09.09 0 01-.091.092z"/><path d="M2.53.633a.11.11 0 00-.026-.067L1.965.029A.09.09 0 001.898 0h-1.5a.095.095 0 00-.096.095v1.236h2.229L2.53.633zM1.92.611L1.919.156l.477.455H1.92z"/></svg>',this.symbols.expand.src+='<svg xmlns="http://www.w3.org/2000/svg" width="2.834" height="2.834" fill="DimGray"><path d="M2.711 0h-.693a.124.124 0 00-.124.123l.285.287-.343.344a.17.17 0 00-.053.125.179.179 0 00.303.125L2.429.66l.282.284A.124.124 0 002.834.82V.125A.124.124 0 002.711 0zM2.709 1.893l-.289.29-.351-.351a.177.177 0 00-.25 0 .174.174 0 000 .248l.351.351-.279.278c0 .067.057.123.123.123h.695a.125.125 0 00.125-.123v-.692a.124.124 0 00-.125-.124zM.66.408L.944.125A.124.124 0 00.82.002H.125A.125.125 0 000 .125v.692C0 .886.057.94.125.94L.41.656l.354.354c.033.035.079.052.125.052s.09-.017.125-.052a.177.177 0 000-.249L.66.408zM.873 1.713l-.463.465-.287-.287A.123.123 0 000 2.015v.696c0 .068.056.123.123.123h.693a.123.123 0 00.123-.123l-.281-.283.465-.465a.179.179 0 000-.25.179.179 0 00-.25 0z"/></svg>',this.symbols.magnify.src+='<svg xmlns="http://www.w3.org/2000/svg" width="2.834" height="2.834" fill="DimGray"><path d="M.291 1.693a.995.995 0 001.354.047l.179.18a.169.169 0 00.038.186l.677.679a.177.177 0 00.244 0 .176.176 0 000-.246l-.677-.676a.17.17 0 00-.186-.038l-.18-.18A.99.99 0 001.694.291a.99.99 0 00-1.403 0 .99.99 0 000 1.402zM.16.992A.83.83 0 011.582.404a.835.835 0 01-.59 1.422A.835.835 0 01.16.992z"/><path d="M.463 1.523A.748.748 0 10.994.244a.746.746 0 00-.75.748c0 .2.077.389.219.531zm.645.059a.04.04 0 01-.022.006.639.639 0 01-.5-.187.64.64 0 01-.163-.637.06.06 0 01.03-.033A.053.053 0 01.494.73a.062.062 0 01.01.003.055.055 0 01.031.062v.006a.514.514 0 00.131.517.521.521 0 00.406.152.057.057 0 01.06.045l.002.007-.001.022-.002.006-.006.015a.135.135 0 01-.017.017z"/></svg>',this.symbols.refresh.src+='<svg xmlns="http://www.w3.org/2000/svg" width="2.835" height="2.835" fill="DimGray"><path d="M0 1.399A1.26 1.26 0 011.142.162a1.255 1.255 0 011.131.496c.104.139.178.293.219.461h.305c.014 0 .026.007.033.021a.037.037 0 010 .038l-.438.762a.05.05 0 01-.014.015.038.038 0 01-.054-.007l-.002-.006-.443-.764c-.007-.012-.007-.027 0-.039s.021-.019.035-.019h.281a.981.981 0 00-.31-.458.987.987 0 00-1.378.133.976.976 0 00.135 1.379.962.962 0 00.562.221.128.128 0 01.094.051c.007.008.011.017.015.023.004.012.01.022.015.033a.123.123 0 01-.011.123.127.127 0 01-.111.055 1.256 1.256 0 01-.951-.501A1.267 1.267 0 010 1.399z"/></svg>',this.symbols.paperclip.classList.add("paperclip"),this.symbols.refresh.classList.add("refresh"),this.symbols.filter.classList.add("kw-hidden"),this.options.hideButtons&&(this.symbols.filter.classList.add("kw-hidden"),this.symbols.paperclip.classList.add("kw-hidden"),this.symbols.disk.classList.add("kw-hidden"),this.symbols.printer.classList.add("kw-hidden"),this.symbols.expand.classList.add("kw-hidden"),this.symbols.magnify.classList.add("kw-hidden"),this.symbols.refresh.classList.add("kw-hidden")),this.events.filterUIClickOffWindowEvent=()=>{this.filterUI.classList.add("kw-hidden"),window.removeEventListener("click",this.events.filterUIClickOffWindowEvent),this.filterUI.removeEventListener("click",this.events.filterUIClickOffUIEvent)},this.events.filterUIClickOffUIEvent=t=>{t.stopPropagation()}}setJsonData(t){if(this.jsonDataOriginal=t,"string"==typeof this.jsonData&&(this.jsonData=JSON.parse(this.jsonData)),Array.isArray(t[0])){let i=[],a=t[0].length;t.forEach(t=>{a!==t.length&&console.error("Number of columns changed");let e={},s=0;t.forEach(t=>{e["col"+s]=t,s++}),i.push(e)}),t=i}t.forEach(e=>{Object.keys(this.keyMap).forEach(t=>{void 0!==this.keyMap[t].remove&&this.keyMap[t].remove&&delete e[t.toString()]})}),this.jsonData=t,void 0===this.jsonData||!this.jsonData||this.jsonData.length<=1?(console.log("clsDataTable.update: jsonData is empty"),this.jsonData=[]):(this.keys=[],Object.keys(this.jsonData[0]).forEach(t=>{this.keys.push(t),this.filters[t]={},this.filters[t].value="",this.filters[t].show=!0})),this.update()}buildFilters(){var t=document.createElement("div");let e=document.createElement("input"),s=document.createElement("button");this.filterBtns=document.createElement("div"),this.filterBtns.classList.add("filterBtns"),this.filterBtns.style.minWidth=this.minWidth,this.filterBtns.append(this.symbols.filter),this.filterBtns.append(this.symbols.expand),this.filterBtns.append(this.symbols.disk),this.filterBtns.append(this.symbols.paperclip),this.filterBtns.append(this.symbols.printer),this.filterBtns.append(this.symbols.refresh),this.symbols.disk.addEventListener("click",()=>{this.handleExport()}),this.symbols.paperclip.addEventListener("click",t=>{var e=""+this.convert("tab");navigator.clipboard.writeText(e),this.symbols.paperclip.classList.add("pushed"),setTimeout(()=>{this.symbols.paperclip.classList.remove("pushed")},1200)}),this.symbols.expand.setAttribute("expanded",!1),this.symbols.expand.addEventListener("click",()=>{"false"==this.symbols.expand.getAttribute("expanded")?(this.symbols.expand.setAttribute("expanded",!0),this.container.requestFullscreen()):(document.exitFullscreen(),this.symbols.expand.setAttribute("expanded",!1))}),this.symbols.printer.addEventListener("click",()=>{this.print()}),this.symbols.filter.addEventListener("click",()=>{this.filterUIPopup()}),this.symbols.refresh.addEventListener("click",()=>{s.dispatchEvent(new Event("click")),this.options.refreshFunction(),this.symbols.refresh.classList.add("rotating"),setTimeout(()=>{this.symbols.refresh.classList.remove("rotating")},500)}),t.classList.add("searchBox"),e.classList.add("searchInput"),e.placeholder="Search",e.style.backgroundImage="url('"+this.symbols.magnify.src+"')",e.style.backgroundPositionY="center",e.style.backgroundPositionX="2px",e.style.backgroundRepeat="no-repeat",e.style.backgroundSize="1rem",e.addEventListener("keyup",()=>{this.searchJsonData(e.value)}),e.addEventListener("change",()=>{this.searchJsonData(e.value)}),t.append(e),s.classList.add("searchCancelBtn"),s.innerHTML="X",s.addEventListener("click",()=>{e.value="",Array.from(this.table.querySelectorAll(".table-row-group .table-row")).forEach(t=>{t.classList.remove("kw-hidden")})}),t.append(s),this.filterBtns.append(t),this.container.append(this.filterBtns)}buildEmptyTable(){this.table&&this.table.remove(),this.filterBtns||this.buildFilters(),this.table=document.createElement("div"),this.table.classList.add("table"),this.container.append(this.table)}revertJsonData(){this.setJsonData(this.jsonDataOriginal)}sortJsonData(s){const i=(t,e)=>(t=t.toString().toLowerCase(),e=e.toString().toLowerCase(),"down"===this.sortObj.direction?t<e?-1:e<t?1:0:t<e?1:e<t?-1:0);this.jsonData.sort((t,e)=>i(t[s],e[s])),this.buildTable(this.jsonData)}applyFilters(){let t=JSON.parse(JSON.stringify(this.jsonData));t=t.map(e=>(this.keys.forEach(t=>{this.filters[t].show||delete e[t]}),e)),this.buildTable(t)}searchJsonData(s){Array.from(this.table.querySelectorAll(".table-row-group .table-row")).forEach(t=>{let e=!1;Array.from(t.querySelectorAll(".table-cell")).forEach(t=>{-1<t.innerHTML.indexOf(s)&&(e=!0)}),e?t.classList.remove("kw-hidden"):t.classList.add("kw-hidden")})}update(){this.jsonData&&this.jsonData.length<=1?console.log("clsDataTable.update: jsonData is empty"):(this.keys=[],Object.keys(this.jsonData[0]).forEach(t=>{this.keys.push(t),void 0!==this.filters[t].value&&this.filters[t].value||(this.filters[t].value=""),void 0===this.filters[t].show&&(this.filters[t].show=!0)})),this.buildTable(this.jsonData)}buildTable(t){if(this.buildEmptyTable(),void 0!==this.keys&&this.keys&&0!==this.keys.length){var s=document.createElement("div");s.classList.add("table-header-group"),this.options.freezeHeader&&s.classList.add("sticky-header");let n=document.createElement("div");n.classList.add("table-row");let l=0,e=(this.keys.forEach(t=>{var e,s,i,a;this.filters[t].show&&((e=document.createElement("div")).classList.add("table-cell"),this.keyMap&&this.keyMap[t]&&this.keyMap[t].title?e.innerHTML=this.keyMap[t].title:this.keyMap&&this.keyMap[l]&&this.keyMap[l].title?e.innerHTML=this.keyMap[l].title:e.innerHTML=t,(this.keyMap&&this.keyMap[t]&&this.keyMap[t].hidden||this.keyMap&&this.keyMap[l]&&this.keyMap[l].hidden)&&e.classList.add("kw-hidden"),this.options.sort&&((s=document.createElement("span")).classList.add("column-sort"),(i=document.createElement("div")).innerHTML="▲",(a=document.createElement("div")).innerHTML="▼",s.append(i),s.append(a),s.addEventListener("click",()=>{void 0===this.sortObj.key||!this.sortObj.key||this.sortObj.key!==t?(this.sortObj.key=t,this.sortObj.direction="down"):"up"===this.sortObj.direction?this.sortObj.direction="down":"down"===this.sortObj.direction&&(this.sortObj.direction="up"),this.sortJsonData(t),this.sortVal=-1*this.sortVal}),e.append(s)),n.append(e),l++)}),s.append(n),this.table.append(s),document.createElement("div")),r=(e.classList.add("table-row-group"),0);t.forEach(a=>{let n=document.createElement("div");var t="row-"+r;n.classList.add("table-row",t),this.options.altRowColor&&0<r&&(t=r,1==Math.abs(t%2))&&n.classList.add("bg-altRowGreyLite"),void 0!==this.options.rowHeight&&this.options.rowHeight&&(n.style.height=this.options.rowHeight),void 0!==this.options.rowHeightMin&&this.options.rowHeightMin&&(n.style.minHeight=this.options.rowHeightMin),void 0!==this.options.rowHeightMax&&this.options.rowHeightMax&&(n.style.maxHeight=this.options.rowHeightMax);let l=0;Object.keys(a).forEach(t=>{var e,s=new Object,i=(s.key=a[t],document.createElement("div"));i.classList.add("table-cell"),"object"==typeof s?(e=Object.keys(s)[0],i.innerHTML=s[e]):console.error("clsDataTable: buildTable - jsonData columns should be an object"),this.keyMap&&this.keyMap[t]&&this.keyMap[t].render?(s=i.innerHTML,i.innerHTML="","object"==typeof(e=this.keyMap[t].render(s))?i.append(e):i.innerHTML=e):this.keyMap&&this.keyMap[l]&&this.keyMap[l].render&&(s=i.innerHTML,i.innerHTML="","object"==typeof(e=this.keyMap[l].render(s))?i.append(e):i.innerHTML=e),i.classList.add(t),(this.keyMap&&this.keyMap[t]&&this.keyMap[t].hidden||this.keyMap&&this.keyMap[l]&&this.keyMap[l].hidden)&&i.classList.add("kw-hidden"),0===r&&this.keyMap&&this.keyMap[l]&&this.keyMap[l].width?i.style.setProperty("width",this.keyMap[l].width,"important"):0===r&&void 0!==this.options.colWidth&&this.options.colWidth&&i.style.setProperty("width",this.options.colWidth,"important"),0===r&&this.keyMap&&this.keyMap[l]&&this.keyMap[l].minwidth?i.style.setProperty("min-width",this.keyMap[l].minwidth,"important"):0===r&&void 0!==this.options.colWidthMin&&this.options.colWidthMin&&i.style.setProperty("min-width",this.options.colWidthMin,"important"),0===r&&this.keyMap&&this.keyMap[l]&&this.keyMap[l].maxwidth?i.style.setProperty("max-width",this.keyMap[l].maxwidth,"important"):0===r&&void 0!==this.options.colWidthMax&&this.options.colWidthMax&&i.style.setProperty("max-width",this.options.colWidthMax,"important"),n.append(i),l++}),e.append(n),r++}),this.table.append(e),this.options.includeFooter&&((s=document.createElement("div")).classList.add("table-header-group"),s.append(n.cloneNode(!0)),Array.from(s.querySelectorAll("*")).forEach(t=>{t.classList.contains("column-sort")&&t.remove()}),this.table.append(s))}else this.table.innerHTML=`<h1 class="">&nbsp;</h1>
            <div class="table-row-group">
                <div class="table-row">
                    <div class="no-results">No Results</div>
                </div>
            </div>`}print(){let s=[],i=(s.push(this.container.parent),[]),a=t=>{t=t.parentNode;s.push(t);let e=t.firstChild;for(;e;)1===e.nodeType&&e!==this.container&&s.indexOf(e)<=-1&&!e.classList.contains("kw-hidden")&&"SCRIPT"!==e.nodeName&&i.push(e),e=e.nextSibling;"BODY"!==t.nodeName&&a(t)},e=(a(this.container),i.forEach(t=>{t.classList.add("kw-hidden")}),this.filterBtns.classList.add("kw-hidden"),this.table.querySelectorAll(".column-sort")),n=(e.forEach(t=>{t.classList.add("kw-hidden")}),t=>{i.forEach(t=>{t.classList.remove("kw-hidden")}),this.filterBtns.classList.remove("kw-hidden"),e.forEach(t=>{t.classList.remove("kw-hidden")}),window.removeEventListener("afterprint",n)});window.addEventListener("afterprint",n),window.print()}filterUIPopup(){Array.from(this.filterUI.querySelectorAll("*")).forEach(t=>{t.remove()});var t=document.createElement("div"),e=(t.classList.add("titleRow","w-full","mb-3"),document.createElement("div")),e=(e.classList.add("title","inline-block","font-bold","text-lg","w-8/12"),e.innerHTML="Filters",t.append(e),document.createElement("button")),e=(e.classList.add("inline-block","border","rounded","text-greyDark","text-center","bg-greyLite","h-full","ml-1","font-bold","w-6","float-right"),e.innerHTML="X",e.addEventListener("click",()=>{this.filterUI.classList.add("kw-hidden"),setTimeout(()=>{window.removeEventListener("click",this.events.filterUIClickOffWindowEvent),this.filterUI.removeEventListener("click",this.events.filterUIClickOffUIEvent)},500)}),t.append(e),document.createElement("div")),s=(e.classList.add("w-full"),document.createElement("button")),s=(s.classList.add("border","rounded","text-greyDark","text-center","bg-greyLite","p-1"),s.innerHTML="Clear Filters",s.addEventListener("click",()=>{this.filterUI.classList.toggle("kw-hidden"),setTimeout(()=>{window.removeEventListener("click",this.events.filterUIClickOffWindowEvent),this.filterUI.removeEventListener("click",this.events.filterUIClickOffUIEvent)},500),this.revertJsonData()}),e.append(s),t.append(e),this.filterUI.append(t),document.createElement("div")),e=(s.classList.add("w-full","mb-3","font-bold"),document.createElement("div")),t=(e.classList.add("w-2/12","text-left","inline-block","underline"),e.innerHTML="Col",document.createElement("div")),i=(t.classList.add("w-5/12","text-center","inline-block","underline"),t.innerHTML="Filter",document.createElement("div")),a=(i.classList.add("w-1/12","text-center","inline-block","underline"),i.innerHTML="Clr",document.createElement("div"));a.classList.add("w-4/12","text-right","inline-block","underline"),a.innerHTML="+/-&nbsp;",s.append(e,t,i,a),this.filterUI.append(s),Object.keys(this.filters).forEach(t=>{document.createElement("div").classList.add("block");var e=document.createElement("div"),s=(e.classList.add("w-full","mb-2","align-middle"),document.createElement("span"));s.classList.add("inline-block","w-2/12","align-middle"),s.innerHTML=t+":&nbsp;",e.append(s);let i=document.createElement("input");i.type="text",i.classList.add("w-5/12"),i.classList.add("kw-hidden"),i.classList.add("bg-transparent","inline-block","h-7","border","border-slate","rounded-md","sm:text-sm","focus:border-greyLite","p-1","pl-6","shadow-sm","placeholder-slate","focus:outline-none","align-middle"),i.value=this.filters[t].value,i.addEventListener("keyup",()=>{this.filters[t].value=i.value,this.applyFilters()}),e.append(i);s=document.createElement("button");s.classList.add("inline-block","border","rounded","text-greyDark","bg-greyLite","h-full","ml-1","w-5","font-bold","align-middle"),s.classList.add("kw-hidden"),s.innerHTML="X",s.addEventListener("click",()=>{i.value="",this.filters[t].value="",this.applyFilters()}),e.append(s);let a=document.createElement("input");a.type="checkbox",a.classList.add("bg-transparent","inline","h-7","border","border-slate","rounded-md","sm:text-sm","p-1","pl-6","shadow-sm","placeholder-slate","float-right","align-middle"),a.classList.add("focus:border-greyLite","focus:checked:border-greyLite","focus:border-greyLite","focus:outline-none"),a.classList.add("checked:bg-slate","focus:bg-white","focus:checked:bg-slate","focus-visible:bg-white","focus-visible:checked:bg-slate","hover:border-greyLite","hover:bg-black","hover:checked:bg-black"),a.checked=this.filters[t].show,a.addEventListener("change",()=>{this.filters[t].show=a.checked,this.applyFilters()}),e.append(a),this.filterUI.append(e),setTimeout(()=>{window.addEventListener("click",this.events.filterUIClickOffWindowEvent),this.filterUI.addEventListener("click",this.events.filterUIClickOffUIEvent)},800)}),this.filterUI.classList.toggle("kw-hidden")}handleExport(){let t=document.createElement("div");t.classList.add("p-4","block","absolute","bg-greyLite","z-9999","border","rounded","w-96","h-64","max-h-64","overflow-y-auto","top-10","left-44");var e=document.createElement("div"),s=(e.classList.add("w-full","mb-6"),document.createElement("div")),s=(s.classList.add("inline-block","w-3/4","text-lg","font-bold"),s.innerHTML="Export",e.append(s),document.createElement("button")),s=(s.classList.add("inline-block","border","rounded","p-2","text-sm","bg-greyLite","font-bold","float-right"),s.innerHTML="X",s.addEventListener("click",()=>{t.remove()}),e.append(s),t.append(e),document.createElement("button")),e=(s.classList.add("block","border","rounded","p-2","m-2","bg-slate","text-white","font-bold"),s.innerHTML="Download as CSV Comma Delimited",s.addEventListener("click",()=>{this.export("csv"),t.remove()}),t.append(s),document.createElement("button")),s=(e.classList.add("block","border","rounded","p-2","m-2","bg-slate","text-white","font-bold"),e.innerHTML="Download as TSV Tab Delimited",e.addEventListener("click",()=>{this.export("tab"),t.remove()}),t.append(e),document.createElement("button"));s.classList.add("block","border","rounded","p-2","m-2","bg-slate","text-white","font-bold"),s.innerHTML="Download as JSON",s.addEventListener("click",()=>{this.export("json"),t.remove()}),t.append(s),this.container.append(t)}convert(t){let i=[],a=[];if(Array.from(this.table.querySelectorAll(".table-header-group .table-cell")).forEach(t=>{t.classList.contains("kw-hidden")||(t=t.innerHTML,t=this.stripHtml(t),a.push(t))}),Array.from(this.table.querySelectorAll(".table-row-group .table-row")).forEach(t=>{if(!t.classList.contains("kw-hidden")){let e={},s=0;Array.from(t.querySelectorAll(".table-cell")).forEach(t=>{t.classList.contains("kw-hidden")||(t=this.getHtmlValue(t),e[a[s]]=t,s++)}),i.push(e)}}),"json"===t)return JSON.stringify(i);if("csv"===t){let t="";return t+=a.join(",")+`\r
`,i.forEach(e=>{let s="";a.forEach(t=>{s+=`"${e[t]}",`}),s=s.replace(/,\s*$/,""),t+=s+`\r
`}),t}if("tab"===t){let t="";return t+=a.join(`	`)+`\r
`,i.forEach(e=>{let s="";a.forEach(t=>{s+=`"${e[t]}"	`}),s=s.replace(/,\s*$/,""),t+=s+`\r
`}),t}}export(t){let e="";var s=document.createElement("a"),t=("csv"===t&&(e="data:text/csv;charset=utf-8,",s.setAttribute("download","export.csv")),"tab"===t&&(e="data:text/tab-separated-values;charset=utf-8,",s.setAttribute("download","export.tsv")),"json"===t&&(e="data:application/json;charset=utf-8,",s.setAttribute("download","export.json")),e+encodeURI(this.convert(t)));s.style.visibility="hidden",s.setAttribute("href",t),document.body.appendChild(s),s.click(),s.remove()}getHtmlValue(t){let e,s=0;return t.childNodes.forEach(t=>{void 0!==t.value&&(e=t.value),s++}),e=e||this.stripHtml(t.innerHTML)}containsHtmlNode(t){let e=!1;return t.childNodes.forEach(t=>{1===t.nodeType&&(e=!0)}),e}stripHtml(t){return t=(t=(t=(t=t.replaceAll(/<[^>]*>/g,"")).replace("▲▼","")).replace("▲","")).replace("▼","")}toBinary(s){var t=Uint16Array.from({length:s.length},(t,e)=>s.charCodeAt(e)),t=new Uint8Array(t.buffer);let e="";return t.forEach(t=>{e+=String.fromCharCode(t)}),e}randomID(){var t="a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z".split(",")[Math.floor(26*Math.random())];return"DT-"+Math.floor(101*Math.random())+t+"-"+Date.now()}}